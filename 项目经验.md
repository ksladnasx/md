# @errorå¤„ç†å¼‚å¸¸ï¼Œè°ƒç”¨å‡½æ•°

åœ¨ Vue 3 ä¸­ï¼Œ`@error` æ˜¯ç”¨äºç›‘å¬ DOM å…ƒç´ æˆ–ç»„ä»¶ä¸Šçš„é”™è¯¯äº‹ä»¶çš„ä¸€ç§æ–¹å¼ã€‚å½“ç»‘å®šçš„å…ƒç´ æˆ–ç»„ä»¶å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¯ä»¥è§¦å‘ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å¤„ç†å¼‚å¸¸ã€‚ä»¥ä¸‹æ˜¯å…³äº `@error` å¤„ç†å¼‚å¸¸å’Œè°ƒç”¨å‡½æ•°çš„è¯¦ç»†è§£é‡Šå’Œç¤ºä¾‹ã€‚

### **1. ä½¿ç”¨ `@error` ç›‘å¬ DOM å…ƒç´ çš„é”™è¯¯äº‹ä»¶**
`@error` å¯ä»¥ç›´æ¥ç»‘å®šåˆ° HTML å…ƒç´ ï¼ˆå¦‚ `<img>`ã€`<video>` ç­‰ï¼‰ä¸Šï¼Œç”¨äºæ•è·åŠ è½½å¤±è´¥æˆ–å…¶ä»–é”™è¯¯äº‹ä»¶ã€‚

#### ç¤ºä¾‹ï¼š
```vue
<template>
  <div>
    <img :src="imageUrl" @error="handleError" alt="ç¤ºä¾‹å›¾ç‰‡" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      imageUrl: 'https://example.com/image.jpg',
    };
  },
  methods: {
    handleError(event) {
      console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', event);
      // å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œå…¶ä»–é€»è¾‘ï¼Œä¾‹å¦‚æ˜¾ç¤ºé»˜è®¤å›¾ç‰‡
      event.target.src = 'https://example.com/default.jpg';
    },
  },
};
</script>
```

### **2. ä½¿ç”¨ `@error` ç›‘å¬ç»„ä»¶çš„é”™è¯¯äº‹ä»¶**
å¯¹äº Vue ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ `@error` ç›‘å¬å­ç»„ä»¶æŠ›å‡ºçš„é”™è¯¯äº‹ä»¶ã€‚

#### ç¤ºä¾‹ï¼š
```vue
<template>
  <div>
    <ChildComponent @error="handleError" />
  </div>
</template>

<script>
import ChildComponent from './ChildComponent.vue';

export default {
  components: { ChildComponent },
  methods: {
    handleError(error) {
      console.error('å­ç»„ä»¶å‘ç”Ÿé”™è¯¯:', error);
      // å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œå…¶ä»–é€»è¾‘ï¼Œä¾‹å¦‚æ˜¾ç¤ºé”™è¯¯æç¤º
    },
  },
};
</script>
```

### **3. ä½¿ç”¨ `errorCaptured` ç”Ÿå‘½å‘¨æœŸé’©å­**
`errorCaptured` æ˜¯ Vue 3 æä¾›çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œç”¨äºæ•è·å­ç»„ä»¶çš„é”™è¯¯ã€‚å®ƒå¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨æ•è·é”™è¯¯å¹¶å¤„ç†ã€‚

#### ç¤ºä¾‹ï¼š
```vue
<template>
  <div>
    <ChildComponent />
  </div>
</template>

<script>
import ChildComponent from './ChildComponent.vue';

export default {
  components: { ChildComponent },
  errorCaptured(err, instance, info) {
    console.error('æ•è·åˆ°å­ç»„ä»¶é”™è¯¯:', err, info);
    return false; // è¿”å› false é˜»æ­¢é”™è¯¯å‘ä¸Šä¼ æ’­
  },
};
</script>
```

### **4. å…¨å±€é”™è¯¯å¤„ç†**
Vue 3 æä¾›äº† `app.config.errorHandler` é…ç½®é€‰é¡¹ï¼Œç”¨äºå…¨å±€æ•è·æœªå¤„ç†çš„é”™è¯¯ã€‚

#### ç¤ºä¾‹ï¼š
```javascript
import { createApp } from 'vue';
import App from './App.vue';

const app = createApp(App);

app.config.errorHandler = (err, instance, info) => {
  console.error('å…¨å±€é”™è¯¯æ•è·:', err, info);
  // å¯ä»¥åœ¨è¿™é‡Œè®°å½•é”™è¯¯æˆ–é€šçŸ¥ç”¨æˆ·
};

app.mount('#app');
```

### **5. å¼‚æ­¥é”™è¯¯å¤„ç†**
å¯¹äºå¼‚æ­¥æ“ä½œï¼ˆå¦‚ API è¯·æ±‚ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `try...catch` æˆ– `Promise.catch` æ¥æ•è·é”™è¯¯ã€‚

#### ç¤ºä¾‹ï¼š
```vue
<template>
  <div>
    <button @click="loadData">åŠ è½½æ•°æ®</button>
  </div>
</template>

<script>
export default {
  methods: {
    async loadData() {
      try {
        const data = await this.fetchData();
        console.log('æ•°æ®åŠ è½½æˆåŠŸ:', data);
      } catch (error) {
        console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
        // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
      }
    },
    async fetchData() {
      throw new Error('æ¨¡æ‹Ÿçš„ç½‘ç»œé”™è¯¯');
    },
  },
};
</script>
```

### **6. ä½¿ç”¨ `ErrorBoundary` ç»„ä»¶**
`ErrorBoundary` æ˜¯ä¸€ç§å°è£…é”™è¯¯å¤„ç†çš„ç»„ä»¶æ¨¡å¼ï¼Œç”¨äºæ•è·å­ç»„ä»¶çš„é”™è¯¯å¹¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯é¡µé¢ã€‚

#### ç¤ºä¾‹ï¼š
```vue
<!-- ErrorBoundary.vue -->
<template>
  <div>
    <slot v-if="!hasError"></slot>
    <div v-else>
      <h1>å‘ç”Ÿé”™è¯¯</h1>
      <p>è¯·åˆ·æ–°é¡µé¢æˆ–ç¨åå†è¯•ã€‚</p>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      hasError: false,
    };
  },
  errorCaptured(err) {
    this.hasError = true;
    return false; // é˜»æ­¢é”™è¯¯å‘ä¸Šä¼ æ’­
  },
};
</script>
```

ä½¿ç”¨æ—¶ï¼š
```vue
<template>
  <ErrorBoundary>
    <HeavyComponent />
  </ErrorBoundary>
</template>

<script>
import ErrorBoundary from './ErrorBoundary.vue';
import HeavyComponent from './HeavyComponent.vue';

export default {
  components: { ErrorBoundary, HeavyComponent },
};
</script>
```

### **æ€»ç»“**
åœ¨ Vue 3 ä¸­ï¼Œ`@error` æ˜¯ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„æ–¹å¼ï¼Œç”¨äºç›‘å¬å’Œå¤„ç† DOM å…ƒç´ æˆ–ç»„ä»¶çš„é”™è¯¯äº‹ä»¶ã€‚ç»“åˆ `errorCaptured`ã€`app.config.errorHandler` å’Œ `try...catch` ç­‰æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä»å±€éƒ¨åˆ°å…¨å±€çš„é”™è¯¯å¤„ç†ï¼Œç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## :classåŠ¨æ€ç»‘å®šå­—æ ·å¼

:class="{å­æ ·å¼å: å±•ç¤ºè¯¥æ ·å¼çš„æ¡ä»¶}"

```vue
 <div class="pagination" v-if="totalPages > 0">
            <button  :disabled="currentPage === 1" @click="prevPage" ><</button>
            <button @click="changePage($event)" :class="{ active: showPage === currentPage || inpval == showPage}">{{ showPage }}</button>
            <button @click="changePage($event)" v-if="showPage + 1 <= totalPages"
                :class="{ active: currentPage === showPage + 1 || inpval == showPage+1}">{{ showPage + 1 }}</button>
            <button @click="changePage($event)" v-if="showPage + 2 <= totalPages"
                :class="{ active: currentPage === showPage + 2 || inpval == showPage+2}">{{ showPage + 2 }}</button>
            <button @click="changePage($event)" v-if="showPage + 3 <= totalPages"
                :class="{ active: currentPage === showPage + 3 || inpval == showPage+3}">{{ showPage + 3 }}</button>
            <!-- <span>ç¬¬ {{ currentPage }} é¡µ / å…± {{ totalPages }} é¡µ</span> -->
            <button  :disabled="currentPage === totalPages" @click="nextPage">></button>
            <div> 
              <input type="text" style="width: 60px; " v-model="inpvals"> <button @click="gotoPage">Go</button>
            </div>
        </div>
```

ç„¶åæ ·å¼éƒ¨åˆ†

```css
/* æ·»åŠ ä¸€ä¸ªç®€å•çš„ active çŠ¶æ€æ ·å¼ */
button.active {
    background-color: #6eb9fb;
    /* ç»¿è‰²èƒŒæ™¯ */
    color: white;
    /* ç™½è‰²æ–‡å­— */
}
```

## v-if çš„å·§ç”¨

app.vueæ–‡ä»¶ä¸­ï¼Œåœ¨å„ä¸ªè·¯ç”±ä¸­ï¼Œåªæœ‰å½“ä¸æ˜¯ç™»å½•æ³¨å†Œé¡µé¢æ—¶æ‰å±•ç¤ºä¾§è¾¹æ 

```vue
<template>
  <div class="app-container">
    <!-- åªåœ¨éç™»å½•/æ³¨å†Œ/æ‰¾å›å¯†ç é¡µé¢æ˜¾ç¤ºä¾§è¾¹æ  -->
    <Sidebar v-if="shouldShowSidebar()" />
    
    <div class="main-content" :class="{ 'with-sidebar': shouldShowSidebar() }">
      <router-view v-slot="{ Component }">
        <transition name="fade" mode="out-in">
          <component :is="Component" />
        </transition>
      </router-view>
    </div>
  </div>
</template>
<script>
// åˆ¤æ–­å½“å‰è·¯ç”±æ˜¯å¦éœ€è¦æ˜¾ç¤ºä¾§è¾¹æ 
const shouldShowSidebar = () => {
  const publicRoutes = ['Login', 'Register', 'ForgotPassword'];
  return !publicRoutes.includes(router.currentRoute.value.name as string);
};</script>
```

# flex :1

å±•ç¤ºä¾§è¾¹æ åå‰©ä½™ç©ºé—´æ‰æ˜¯ç»™å„ä¸ªè·¯ç”±å¯¹åº”æ–‡ä»¶ç”¨çš„

è¿™æ ·æ‰èƒ½æ­£ç¡®å±•ç¤ºé™¤äº†ä¾§è¾¹æ ä¹‹å¤–çš„å†…å®¹

```css
.main-content {
  flex: 1;
  overflow-y: auto;
  transition: all 0.3s ease;
}

```

`flex: 1;` æ˜¯ CSS `flex` å¸ƒå±€ä¸­ä¸€ä¸ªç®€å†™çš„æ ·å¼å±æ€§ï¼Œä¸»è¦ç”¨æ¥å®šä¹‰å­å…ƒç´ åœ¨å®¹å™¨ä¸­çš„ä¼¸ç¼©è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯å…³äºå®ƒçš„è¯¦ç»†è§£é‡Šå’Œç”¨æ³•ç¤ºä¾‹ã€‚

### **`flex` å±æ€§çš„å®šä¹‰**
`flex` æ˜¯ `flex-grow`ã€`flex-shrink` å’Œ `flex-basis` çš„ç®€å†™å½¢å¼ï¼Œåˆ†åˆ«å®šä¹‰å…ƒç´ åœ¨å¼¹æ€§å®¹å™¨ä¸­çš„å¢é•¿ã€æ”¶ç¼©å’ŒåŸºå‡†å¤§å°ã€‚

- **`flex-grow`**ï¼šå®šä¹‰å­å…ƒç´ å¦‚ä½•åˆ†é…å¼¹æ€§å®¹å™¨ä¸­çš„å¤šä½™ç©ºé—´ã€‚å€¼ä¸ºæ•°å­—ï¼Œé»˜è®¤ 0ï¼ˆä¸å¢é•¿ï¼‰ã€‚å€¼è¶Šå¤§ï¼Œå¢é•¿è¶Šå¿«ã€‚
- **`flex-shrink`**ï¼šå®šä¹‰å­å…ƒç´ å¦‚ä½•ç¼©å°ä»¥é€‚åº”å¼¹æ€§å®¹å™¨ä¸­çš„ç©ºé—´ä¸è¶³ã€‚å€¼ä¸ºæ•°å­—ï¼Œé»˜è®¤ 1ï¼ˆå…è®¸ç¼©å°ï¼‰ã€‚å€¼è¶Šå¤§ï¼Œç¼©å°è¶Šå¤šã€‚
- **`flex-basis`**ï¼šå®šä¹‰å­å…ƒç´ åœ¨ä¸»è½´æ–¹å‘ä¸Šçš„åˆå§‹å¤§å°ï¼ˆåŸºç¡€å¤§å°ï¼‰ã€‚é»˜è®¤å€¼ä¸º `auto`ï¼ŒæŒ‡çš„æ˜¯æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´å¤§å°ã€‚

### **`flex: 1;` çš„å«ä¹‰**
`flex: 1;` æ˜¯ä¸€ä¸ªç®€å†™ï¼Œç›¸å½“äºï¼š
```css
flex-grow: 1;
flex-shrink: 1;
flex-basis: 0;
```
ä¹Ÿå°±æ˜¯è¯´ï¼Œ`flex: 1;` è¡¨ç¤ºï¼š
1. å­å…ƒç´ å°†å æ®å¼¹æ€§å®¹å™¨ä¸­æ‰€æœ‰å¯ç”¨ç©ºé—´ï¼ˆ`flex-grow: 1`ï¼‰ï¼Œå¹¶ä¸”
2. å­å…ƒç´ å¯ä»¥è¢«ç¼©å°ï¼ˆ`flex-shrink: 1`ï¼‰ï¼Œ
3. å…¶åˆå§‹å¤§å°ä¸ºåŸºç¡€å¤§å° 0ï¼ˆ`flex-basis: 0`ï¼‰ã€‚

### **ç¤ºä¾‹**
å‡è®¾æœ‰ä¸€ä¸ªå¼¹æ€§çš„å®¹å™¨ï¼ˆ`display: flex;`ï¼‰ï¼Œé‡Œé¢æœ‰å¤šä¸ªå­å…ƒç´ ï¼š
```html
<div class="container">
  <div class="item">Item 1</div>
  <div class="item">Item 2</div>
  <div class="item">Item 3</div>
</div>
```

### **æ ·å¼**
```css
.container {
  display: flex;
  width: 100%;
  border: 1px solid #ccc;
}

.item {
  flex: 1;
  border: 1px solid #666;
  padding: 20px;
  text-align: center;
}
```

### **æ•ˆæœ**
- **çˆ¶å®¹å™¨å®½åº¦ä¸º 100%**ï¼šæ•´ä¸ªå®¹å™¨å æ®çˆ¶çº§çš„å®½åº¦ã€‚
- **ä¸‰ä¸ªå­å…ƒç´ **ï¼ˆItem 1ã€Item 2ã€Item 3ï¼‰ä¼šå¹³åˆ†çˆ¶å®¹å™¨çš„å¯ç”¨ç©ºé—´ï¼š
  - æ¯ä¸ªå­å…ƒç´ çš„å®½åº¦ä¸º `100% / 3 â‰ˆ 33.33%`ã€‚
  - æ‰€æœ‰å­å…ƒç´ çš„é«˜åº¦ä¼šè‡ªåŠ¨è°ƒæ•´ä»¥é€‚åº”çˆ¶å®¹å™¨çš„é«˜åº¦ï¼ˆå¦‚æœçˆ¶å®¹å™¨æ²¡æœ‰å›ºå®šé«˜åº¦ï¼Œå­å…ƒç´ çš„é«˜åº¦ä¼šæ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´ï¼‰ã€‚

### **é—´è·å’Œå†…å®¹å¯¹é½**
å¦‚æœå­å…ƒç´ å†…å®¹è¾ƒçŸ­ï¼Œ`flex: 1;` ä¼šä½¿å®ƒä»¬åœ¨æ¨ªå‘æ–¹å‘ä¸Šå¹³åˆ†ç©ºé—´ã€‚å¦‚æœå†…å®¹è¾ƒé•¿ï¼Œ`flex-shrink: 1;` ä¼šä½¿å®ƒä»¬é€‚å½“ç¼©å°ä»¥é€‚åº”å®¹å™¨å®½åº¦ã€‚

### **å…¶ä»–æƒ…å†µ**
å‡è®¾çˆ¶å®¹å™¨å®½åº¦ä¸º 600pxï¼Œå­å…ƒç´ ä¸­æœ‰ä¸¤ä¸ªï¼š
```html
<div class="container">
  <div class="item">Item A</div>
  <div class="item">Item B</div>
</div>
```

æ ·å¼ï¼š
```css
.item {
  flex: 1;
}
```

ç»“æœï¼š
- Item A å’Œ Item B å„å æ® 300px çš„å®½åº¦ï¼ˆå¹³åˆ† 600px çš„çˆ¶å®¹å™¨å®½åº¦ï¼‰ã€‚

### **å°ç»“**
`flex: 1;` æ˜¯ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„å¸ƒå±€æ–¹å¼ï¼Œé€‚ç”¨äºéœ€è¦å­å…ƒç´ å¹³åˆ†å®¹å™¨ç©ºé—´çš„åœºæ™¯ã€‚é€šè¿‡è°ƒæ•´ `flex-grow` å’Œ `flex-basis`ï¼Œå¯ä»¥å®ç°æ›´å¤æ‚çš„å¸ƒå±€æ•ˆæœã€‚



## å»é™¤æŒ‰é’®ç„¦ç‚¹è¾¹æ¡†

åœ¨ç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œç”±äºç„¦ç‚¹åœ¨æŒ‰é’®ä¸Šï¼Œå¯ä»¥åˆ©ç”¨csså»é™¤æŒ‰é’®ç„¦ç‚¹è¾¹æ¡†

åœ¨style.cssæ–‡ä»¶ä¸­å®šä¹‰å…¨å±€çš„æŒ‰é’®æ ·å¼

```css
button:focus {
    //å»é™¤ç„¦ç‚¹è¾¹æ¡†
  outline: none; 
}
```

éšè—ä¾§è¾¹æ æ»šåŠ¨æ¡

```css
*{
  /* éšè—ä¾§è¾¹æ çš„æ»šåŠ¨æ¡ */
  scrollbar-width: none;
}
```



## ç»„ä»¶ä¹‹é—´ä¼ å‚æ•°

å‡è®¾æˆ‘ç°åœ¨åœ¨ç»„ä»¶ModleFileï¼Œæˆ‘ç°åœ¨ç‚¹å‡»æŒ‰é’®ä¹‹åä¼šè·³è½¬åˆ°å¦å¤–ä¸€ä¸ªç»„ä»¶å¹¶å°†ç­›é€‰å™¨çš„æ¡ä»¶åº”ç”¨åˆ°å¦å¤–ä¸€ä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨ModleFile æ–‡ä»¶ä¸­åº”è¯¥è¿™æ ·å†™ï¼š

åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™å¸¦ä¸Šqueryå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡

```ts
// è·³è½¬åˆ°æ–‡ä»¶ç®¡ç†é¡µé¢å¹¶åº”ç”¨ç­›é€‰æ¡ä»¶
        const goToFileManage = (template: TemplateFile) => {
            router.push({
                path: '/filemanage',
                query: {
                    name: template.name,
                    author: template.createdBy,
                    date: template.modifyDatetime,
                }
            });
        };
```

é‚£ä¹ˆåœ¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶ä¸­åº”è¯¥åœ¨ç»„ä»¶æŒ‚è½½çš„æ—¶å€™å°±æ£€æŸ¥routeè·¯ç”±å™¨é‡Œé¢çš„å‚æ•°ï¼Œå¦‚æœæœ‰å°±å¯¹åº”èµ‹å€¼åˆ°å¯¹åº”çš„ç­›é€‰æ 

```ts

        // æ£€æŸ¥URLå‚æ•°ï¼Œå¦‚æœæœ‰åˆ™åº”ç”¨ç­›é€‰æ¡ä»¶
        onMounted(() => {
            const queryId = route.query.id as string;
            const queryName = route.query.name as string;
            const queryAuthor = route.query.author as string;
            const queryCategory = route.query.category as string;
            const queryModifyDate = route.query.modifyDate as string;

            if (queryId) filters.value.id = queryId;
            if (queryName) filters.value.templateName = queryName;
            if (queryAuthor) filters.value.author = queryAuthor;
            if (queryCategory) filters.value.category = queryCategory;
            if (queryModifyDate) filters.value.modifyDate = queryModifyDate;            
        });
```



## æ¥å£å®šä¹‰æ¥refç±»å‹

æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€ä¸ªç±»å‹æ¥å£

```ts
// ç”¨æˆ·ä¿¡æ¯æ¥å£
export interface UserInfo{
  id: number,
  username:string,
  email:string,
  organization:string,
  avatarUrl:string
}

```

æˆ‘ä»¬ç°åœ¨æƒ³è¦å®šä¹‰ä¸€ä¸ªå¯å˜çš„refç±»å‹å˜é‡ï¼Œåº”ç”¨ä¸Šè¿™ä¸ªç±»å‹æ¥å£ï¼Œï¼Œé‚£ä¹ˆåº”è¯¥è¿™æ ·å†™ï¼š

```ts
const userInfo = ref<UserInfo>({
    id: 21233,
    username: 'å¼ ä¼Ÿ',
    email: 'doctor@126.com',
    organization: 'æŠ€æœ¯éƒ¨',
    avatarUrl: "https://tse3-mm.cn.bing.net/th/id/OIP-C.JCEcaQJVR_vC2kgt6BGZlAAAAA?rs=1&pid=ImgDetMain"
});
```



## æ—¶é—´æˆ³å¤„ç†

åç«¯ä¼ æ¥çš„æ—¶é—´æ˜¯æ•°å­—ç±»å‹çš„æ—¶é—´æˆ³ï¼Œè‡ªç„¶å‰ç«¯è¦å®šä¹‰å‡½æ•°å»å¤„ç†

```ts
export default function (timestamp: number): string{
    // åˆ›å»º Date å¯¹è±¡
    const date = new Date(timestamp);

    // è·å–å¹´æœˆæ—¥
    const year = date.getFullYear();
    const month = date.getMonth() + 1; // getMonth() è¿”å› 0-11ï¼Œéœ€è¦åŠ  1
    const day = date.getDate();

    // è·å–å°æ—¶å’Œåˆ†é’Ÿ
    const hours = date.getHours();
    const minutes = date.getMinutes();

    // åˆ¤æ–­æ˜¯ AM è¿˜æ˜¯ PM
    const ampm = hours >= 12 ? 'PM' : 'AM';

    // å°†å°æ—¶è½¬æ¢ä¸º 12 å°æ—¶åˆ¶
    const hours12 = hours % 12 || 12; // å¦‚æœæ˜¯ 0 ç‚¹ï¼Œæ˜¾ç¤ºä¸º 12 AM

    // æ ¼å¼åŒ–åˆ†é’Ÿï¼Œç¡®ä¿æ˜¯ä¸¤ä½æ•°
    const formattedMinutes = minutes.toString().padStart(2, '0');

    // è¿”å›æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²
    return `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')} ${hours12}:${formattedMinutes} ${ampm}`;
};
```

ç„¶ååœ¨å¯¹åº”çš„ç»„ä»¶é¡µé¢å¼•å…¥è¿™ä¸ªå·¥å…·å‡½æ•°

```ts
import formatDate from "../tools/formatDate";
```

åŒæ—¶é€šè¿‡spiltè¿›è¡Œè‡ªå®šä¹‰å±•ç¤º

```vue
<td>{{ formatDate(template.updateTime).split(" ")[0] }}
                            <div style="font-size: smaller; color: gray;">{{ formatDate(template.updateTime).split(" ")[1]}} {{ formatDate(template.updateTime).split(" ")[2]}} 
                            </div>
</td>
```

# æ–‡ä»¶ä¸Šä¼ 

åœ¨Vue3é¡¹ç›®ä¸­å®ç°æ–‡ä»¶ä¸Šä¼ åˆ°åç«¯ï¼Œå¹¶ä¸”å‰ç«¯éœ€è¦åŒæ—¶ä¼ é€’`userId`ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š

### 1. é¡µé¢æ„å»º
ä½¿ç”¨`<input type="file">`æ ‡ç­¾åˆ›å»ºæ–‡ä»¶é€‰æ‹©å™¨ï¼Œä¾›ç”¨æˆ·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ã€‚åŒæ—¶ï¼Œç¡®ä¿ä½ æœ‰è·å–`userId`çš„é€»è¾‘ï¼ˆä¾‹å¦‚ä»Vuexã€PiniaçŠ¶æ€ç®¡ç†ä¸­è·å–ï¼Œæˆ–è€…ä»APIå“åº”ä¸­è·å–ï¼‰ã€‚

```vue
<template>
  <div>
    <input type="file" @change="handleFileChange" />
    <button @click="uploadFile">ä¸Šä¼ </button>
  </div>
</template>
```

### 2. æ–‡ä»¶é€‰æ‹©ä¸å¤„ç†
ç›‘å¬æ–‡ä»¶é€‰æ‹©äº‹ä»¶ï¼Œè·å–ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶ã€‚åŒæ—¶ï¼Œè·å–`userId`å¹¶å°†å…¶ä¸æ–‡ä»¶ä¸€èµ·å°è£…åˆ°`FormData`å¯¹è±¡ä¸­ã€‚

```javascript
<script setup>
import { ref } from 'vue';
import axios from 'axios';

const selectedFile = ref(null);
const userId = ref('12345'); // å‡è®¾ä»æŸä¸ªåœ°æ–¹è·å–åˆ°çš„ userId

const handleFileChange = (event) => {
  const file = event.target.files[0];
  if (file) {
    selectedFile.value = file;
  }
};
</script>
```

### 3. æ–‡ä»¶ä¸Šä¼ é€»è¾‘
ä½¿ç”¨HTTPå®¢æˆ·ç«¯ï¼ˆå¦‚axiosï¼‰å°†å°è£…å¥½çš„æ–‡ä»¶æ•°æ®å’Œ`userId`å‘é€åˆ°åç«¯APIã€‚è®¾ç½®è¯·æ±‚å¤´ä¸º`multipart/form-data`ï¼Œä»¥ç¡®ä¿æ–‡ä»¶èƒ½æ­£ç¡®ä¸Šä¼ ã€‚

```javascript
const uploadFile = async () => {
  if (!selectedFile.value) return;

  const formData = new FormData();
  formData.append('file', selectedFile.value);
  formData.append('userId', userId.value); // å°† userId æ·»åŠ åˆ° formData ä¸­

  try {
    const response = await axios.post('/api/upload', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    });
    console.log('ä¸Šä¼ æˆåŠŸ:', response.data);
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error);
  }
};
```

### 4. ä¸åç«¯äº¤äº’
ç¡®ä¿åç«¯APIèƒ½å¤Ÿæ¥æ”¶`multipart/form-data`æ ¼å¼çš„è¯·æ±‚ï¼Œå¹¶æ­£ç¡®å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶å’Œ`userId`ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Expresså’Œmulterä¸­é—´ä»¶æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€‚

```javascript
const express = require('express');
const multer = require('multer');
const app = express();
const upload = multer({ dest: 'uploads/' });

app.post('/api/upload', upload.single('file'), (req, res) => {
  if (!req.file) {
    return res.status(400).send({ error: 'è¯·ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶' });
  }
  const userId = req.body.userId; // è·å– userId
  console.log('ä¸Šä¼ çš„æ–‡ä»¶:', req.file);
  console.log('ç”¨æˆ·ID:', userId);
  res.send({ url: req.file.path, filename: req.file.originalname, userId });
});
```

### 5. æ³¨æ„äº‹é¡¹
- **æ–‡ä»¶æ ¼å¼ä¸å¤§å°é™åˆ¶**ï¼šåœ¨å‰ç«¯å¯¹æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œé™åˆ¶ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼å’Œå¤§å°ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
- **ä¸Šä¼ è¿›åº¦æ˜¾ç¤º**ï¼šåˆ©ç”¨axiosçš„`onUploadProgress`æ–¹æ³•ï¼Œå‘ç”¨æˆ·å±•ç¤ºä¸Šä¼ è¿›åº¦ã€‚
- **é”™è¯¯å¤„ç†**ï¼šå¯¹ä¸Šä¼ è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œå¦‚ç½‘ç»œé—®é¢˜ã€æœåŠ¡å™¨é”™è¯¯ç­‰ï¼ŒåŠæ—¶å‘ç”¨æˆ·åé¦ˆã€‚

### æ‰©å±•åŠŸèƒ½
- **å¤šæ–‡ä»¶ä¸Šä¼ **ï¼šå¦‚æœéœ€è¦æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œå¯ä»¥å°†`<input type="file">`çš„`multiple`å±æ€§è®¾ç½®ä¸º`true`ï¼Œå¹¶åœ¨`handleFileChange`ä¸­å¤„ç†å¤šä¸ªæ–‡ä»¶ã€‚
- **æ–‡ä»¶é¢„è§ˆ**ï¼šåœ¨ä¸Šä¼ ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨`URL.createObjectURL(file)`æ–¹æ³•å¯¹æ–‡ä»¶è¿›è¡Œé¢„è§ˆã€‚
- **å–æ¶ˆä¸Šä¼ **ï¼šå¦‚æœéœ€è¦æ”¯æŒå–æ¶ˆä¸Šä¼ åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨axiosçš„`CancelToken`ã€‚

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå°±å¯ä»¥åœ¨Vue3é¡¹ç›®ä¸­å®ç°æ–‡ä»¶ä¸Šä¼ åˆ°åç«¯ï¼Œå¹¶åŒæ—¶ä¼ é€’`userId`çš„åŠŸèƒ½ã€‚

# overflow: hidden;

åœ¨åˆ¶ä½œç±»ä¼¼ç‚¹å‡»äº§ç”Ÿä¸‹æ‹‰æ¡†çš„æ•ˆæœæ—¶ï¼Œåƒä¸‡ä¸èƒ½å°†å¤–éƒ¨å­å®¹å™¨è®¾ç½®æˆè¿™ä¸ªå±æ€§

è¿™æ˜¯æºä»£ç ï¼š

```vue
<td class="action-cell">
                            <div class="act">
                                <button class="action-btn" @click="toggleActionMenu(template.id)">
                                    <span>è¯¦æƒ…</span>
                                    <i class="dropdown-icon">â–¼</i>
                                </button>
                                <div class="action-menu" v-if="showActionMenu === template.id">
                                    <div class="action-item" @click="viewFileDetails(template.id)">
                                        <i class="view-icon"></i>
                                        <span>æŸ¥çœ‹</span>
                                    </div>
                                    <div class="action-item" @click="downloadFile(template.id)">
                                        <i class="download-icon"></i>
                                        <span>ä¸‹è½½</span>
                                    </div>
                                    <div class="action-item delete" @click="renameFile(template.id)">
                                        <i class="delete-icon"></i>
                                        <span>é‡å‘½å</span>
                                    </div>
                                    <div class="action-item delete" @click="deleteFile(template.id)">
                                        <i class="delete-icon"></i>
                                        <span>åˆ é™¤</span>
                                    </div>
                                </div>
                            </div>
                        </td>
```

`overflow: hidden;` æ˜¯ä¸€ä¸ª CSS å±æ€§ï¼Œç”¨äºæ§åˆ¶å…ƒç´ å†…å®¹è¶…å‡ºå…¶å®¹å™¨æ—¶çš„è¡Œä¸ºã€‚å½“å…ƒç´ çš„å†…å®¹è¶…å‡ºå…¶å®¹å™¨çš„å®½åº¦æˆ–é«˜åº¦æ—¶ï¼Œ`overflow: hidden;` ä¼šéšè—è¶…å‡ºçš„éƒ¨åˆ†ã€‚

åœ¨ä½ çš„åœºæ™¯ä¸­ï¼Œå¦‚æœçˆ¶å…ƒç´ ï¼ˆ`td`ï¼‰è®¾ç½®äº† `overflow: hidden;`ï¼Œé‚£ä¹ˆå­å…ƒç´ ï¼ˆ`div`ï¼‰å³ä½¿ä½¿ç”¨äº† `position: absolute;` æˆ– `position: fixed;`ï¼Œä¹Ÿå¯èƒ½è¢«è£å‰ªæ‰è¶…å‡ºçˆ¶å…ƒç´ çš„éƒ¨åˆ†ã€‚

### è§£å†³æ–¹æ¡ˆï¼š

è¦è®©å­å…ƒç´ ï¼ˆ`div`ï¼‰è¦†ç›–çˆ¶å…ƒç´ ï¼ˆ`td`ï¼‰å¹¶ä¸”ä¸å— `overflow: hidden;` çš„é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ï¼š

#### æ–¹æ³• 1ï¼šç§»é™¤çˆ¶å…ƒç´ çš„ `overflow: hidden;`

æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆæ˜¯ç§»é™¤çˆ¶å…ƒç´ ï¼ˆ`td`ï¼‰ä¸Šçš„ `overflow: hidden;` æ ·å¼ã€‚è¿™æ ·å­å…ƒç´ ï¼ˆ`div`ï¼‰å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼Œè€Œä¸ä¼šè¢«è£å‰ªã€‚

```html
<table>
  <tr>
    <td id="parent">
      è¿™æ˜¯çˆ¶å…ƒç´ ï¼ˆtdï¼‰
      <div id="child">è¿™æ˜¯å­å…ƒç´ ï¼ˆdivï¼‰</div>
    </td>
  </tr>
</table>
```

```css
#parent {
  position: relative; /* åˆ›å»ºå®šä½ä¸Šä¸‹æ–‡ */
  width: 200px;
  height: 100px;
  border: 1px solid black;
  /* overflow: hidden; */ /* ç§»é™¤è¿™ä¸€è¡Œ */
}

#child {
  position: absolute;
  top: -20px;
  left: -20px;
  width: 240px;
  height: 120px;
  background-color: red;
  z-index: 1;
}
```

#### æ–¹æ³• 2ï¼šè°ƒæ•´å­å…ƒç´ çš„å®šä½

å¦‚æœæ— æ³•ç§»é™¤çˆ¶å…ƒç´ çš„ `overflow: hidden;`ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´å­å…ƒç´ çš„å®šä½ï¼Œä½¿å…¶ç›¸å¯¹äºé¡µé¢æ ¹å…ƒç´ å®šä½ï¼Œè€Œä¸æ˜¯ç›¸å¯¹äºçˆ¶å…ƒç´ ã€‚

```css
#parent {
  position: relative;
  width: 200px;
  height: 100px;
  border: 1px solid black;
  overflow: hidden; /* çˆ¶å…ƒç´ ä»ç„¶æœ‰ overflow: hidden */
}

#child {
  position: fixed; /* ä½¿ç”¨ fixed å®šä½ */
  top: 0; /* ç›¸å¯¹äºé¡µé¢é¡¶éƒ¨ */
  left: 0; /* ç›¸å¯¹äºé¡µé¢å·¦ä¾§ */
  width: 240px;
  height: 120px;
  background-color: red;
  z-index: 1;
}
```

#### æ–¹æ³• 3ï¼šä½¿ç”¨è´Ÿçš„ `margin`

å¦‚æœå­å…ƒç´ çš„å†…å®¹è¢«è£å‰ªï¼Œå¯ä»¥é€šè¿‡è´Ÿçš„ `margin` å°†å…¶éƒ¨åˆ†ç§»å‡ºçˆ¶å…ƒç´ çš„èŒƒå›´ã€‚

```css
#parent {
  position: relative;
  width: 200px;
  height: 100px;
  border: 1px solid black;
  overflow: hidden;
}

#child {
  margin-top: -20px; /* å‘ä¸Šç§»åŠ¨ */
  margin-left: -20px; /* å‘å·¦ç§»åŠ¨ */
  width: 240px;
  height: 120px;
  background-color: red;
  z-index: 1;
}
```

### æ€»ç»“

- å¦‚æœå¯ä»¥ç§»é™¤çˆ¶å…ƒç´ çš„ `overflow: hidden;`ï¼Œè¿™æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚
- å¦‚æœä¸èƒ½ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ `position: fixed;` æˆ–è´Ÿçš„ `margin` æ¥è°ƒæ•´å­å…ƒç´ çš„ä½ç½®ï¼Œä½¿å…¶æ˜¾ç¤ºåœ¨çˆ¶å…ƒç´ ä¹‹å¤–ã€‚

# åŠ¨æ€æ ·å¼

ç›’å­æ ·å¼è¦å¤šç”¨align-itemsã€justify-contentå’Œtext-alignä»¥åŠdisplay:flex


å…³äºCSSå¸ƒå±€ä¸‰å‰‘å®¢çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€åœºã€Œå…ƒç´ æ’åˆ—èˆä¼šã€çš„æ¯”å–»æ¥ç†è§£å®ƒä»¬çš„åˆ†å·¥ï¼š

---

### 1. **align-itemsï¼šå‚ç›´æ–¹å‘çš„é¢†èˆè€…** 

> **è§’è‰²**ï¼šæ§åˆ¶èˆæ± ï¼ˆflexå®¹å™¨ï¼‰ä¸­æ‰€æœ‰èˆè€…ï¼ˆå­å…ƒç´ ï¼‰åœ¨ä¾§è½´ï¼ˆå‚ç›´æ–¹å‘ï¼‰çš„é˜Ÿå½¢  
> **èˆæ­¥ç¤ºä¾‹**ï¼š
>
> - `center`ï¼šæ‰€æœ‰äººä¿æŒå‚ç›´ä¸­çº¿å¯¹é½ï¼ˆé›†ä½“ç«™å†›å§¿ï¼‰  
> - `flex-start`ï¼šé›†ä½“ç´§è´´å¤©èŠ±æ¿ï¼ˆç‘œä¼½å€’ç«‹å¼ï¼‰  
> - `flex-end`ï¼šé›†ä½“è¹²åœ¨èˆå°åº•éƒ¨ï¼ˆè°¢å¹•é èº¬å¼ï¼‰  
> - `stretch`ï¼šå…¨å‘˜æ‹‰ä¼¸åˆ°åŒé«˜åº¦ï¼ˆèŠ­è•¾è¸®è„šå¼ï¼‰  
>   **ç»å…¸åœºæ™¯**ï¼š  
>   å½“éœ€è¦è®©å¯¼èˆªæ çš„LOGOå’Œèœå•é¡¹å‚ç›´å±…ä¸­æ—¶ï¼Œå°±åƒè®©ä¸åŒèº«é«˜çš„èˆè€…è¸©ç€éšå½¢å°é˜¶è¾¾åˆ°ç»Ÿä¸€é«˜åº¦ï¼š
>
> ```css
> .nav-bar {
>   display: flex;
>   align-items: center; /* å‚ç›´å±…ä¸­é­”æ³• */
> }
> ```

---

### 2. **justify-contentï¼šæ°´å¹³é˜Ÿåˆ—æŒ‡æŒ¥å®˜** 

> **è§’è‰²**ï¼šç¼–æ’èˆè€…ä»¬åœ¨ä¸»è½´ï¼ˆæ°´å¹³æ–¹å‘ï¼‰çš„åˆ†å¸ƒæ–¹å¼  
> **æˆ˜æœ¯æ‰‹åŠ¿**ï¼š
>
> - `center`ï¼šå‘ä¸­çœ‹é½ï¼ˆå›½åº†é˜…å…µæ–¹é˜µï¼‰  
> - `space-between`ï¼šå¤´å°¾è´´è¾¹ï¼Œä¸­é—´ç­‰è·ï¼ˆåœ°é“æ—©é«˜å³°æ’é˜Ÿï¼‰  
> - `space-around`ï¼šæ¯äººè‡ªå¸¦ç­‰è·æ°”æ³¡ï¼ˆè¶…å¸‚è´§æ¶é™ˆåˆ—ï¼‰  
> - `flex-end`ï¼šå‘å³çœ‹é½ï¼ˆå€™è½¦å®¤æ’é˜Ÿæ£€ç¥¨ï¼‰  
>   **å®æˆ˜æ¡ˆä¾‹**ï¼š  
>   å®ç°ç”µå•†ç½‘ç«™çš„å¡ç‰‡ç­‰é—´è·æ’åˆ—ï¼Œå°±åƒæŠŠå•†å“åœ¨è´§æ¶ä¸Šå‡åŒ€é“ºå¼€ï¼š
>
> ```css
> .product-grid {
>   display: flex;
>   justify-content: space-around; /* å‘¼å¸æ„Ÿå¸ƒå±€ */
> }
> ```

---

### 3. **text-alignï¼šæ–‡å­—æ’ç‰ˆæŒ‡æŒ¥å®¶** 

> **è§’è‰²**ï¼šæŒ‡æŒ¥æ–‡æœ¬ä¹ç¬¦åœ¨äº”çº¿è°±ï¼ˆå—çº§å…ƒç´ ï¼‰ä¸­çš„æ°´å¹³ä½ç½®  
> **æŒ‡æŒ¥æ£’åŠ¨ä½œ**ï¼š
>
> - `left`ï¼šå·¦èµ·å¥é¸£æ›²ï¼ˆè¥¿æ–¹æ–‡æœ¬é»˜è®¤åºç« ï¼‰  
> - `right`ï¼šå³èµ·è¿›è¡Œæ›²ï¼ˆé˜¿æ‹‰ä¼¯è¯­ç³»ç¯‡ç« ï¼‰  
> - `center`ï¼šä¸­å¤®Cå¤§è°ƒï¼ˆè¯—æ­Œæ ‡é¢˜åå½©æ®µï¼‰  
> - `justify`ï¼šä¸¤ç«¯å¯¹é½èµ‹æ ¼æ›²ï¼ˆæŠ¥çº¸ä¸“æ ä¸¥è°¨æ’ç‰ˆï¼‰  
>   **ç»å…¸ä¹ç« **ï¼š  
>   è®©åšå®¢æ­£æ–‡å‘ˆç°ä¼˜é›…çš„ä¸¤ç«¯å¯¹é½æ•ˆæœï¼Œå¦‚åŒå°åˆ·ä¹¦ç±çš„ç²¾è‡´æ’ç‰ˆï¼š
>
> ```css
> .article-content {
>   text-align: justify; /* å­¦æœ¯è®ºæ–‡çº§æ’ç‰ˆ */
> }
> ```

---

### ğŸŒŸ ç»„åˆæŠ€æ¼”ç¤º

**åœºæ™¯**ï¼šåˆ¶ä½œä¸€ä¸ªå‚ç›´æ°´å¹³å±…ä¸­ä¸”æ–‡å­—å±…ä¸­çš„æŒ‰é’®  

```css
/* å¤–å±‚flexåŒå±…ä¸­ */
.modal-box {
  display: flex;
  align-items: center;     /* å‚ç›´é¢†èˆ */
  justify-content: center; /* æ°´å¹³æŒ‡æŒ¥ */
  height: 300px;
}

/* å†…éƒ¨æ–‡å­—å±…ä¸­ */
.confirm-btn {
  text-align: center;     /* æ–‡å­—æŒ‡æŒ¥å®¶ */
  padding: 1rem 2rem;
}
```

> è¿™å°±åƒè®©æŒ‰é’®åœ¨èˆå°ä¸­å¤®èšå…‰ç¯ä¸‹å®Œæˆ360åº¦å®Œç¾äº®ç›¸ï¼Œå†…å¤–ä¸‰å±‚å¯¹é½ç³»ç»Ÿå„å¸å…¶èŒ

---

### ğŸ§­ å±æ€§å®šä½æŒ‡å—

| åœºæ™¯             | é€‰ç”¨å±æ€§          | å¦‚åŒ                     |
| ---------------- | ----------------- | ------------------------ |
| å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ | align-items       | è°ƒæ•´ä¹¦æ¶æ¯å±‚çš„ä¹¦è„Šå¯¹é½   |
| å›¾æ ‡æ°´å¹³ç­‰è·æ’åˆ— | justify-content   | ç´é”®å‡åŒ€åˆ†å¸ƒåœ¨é’¢ç´ç›–æ¿   |
| æ®µè½é¦–è¡Œç¼©è¿›     | text-indent       | ä¸­æ–‡æ®µè½å¼€å¤´çš„ä¸¤ä¸ªç©ºæ ¼   |
| å¯¼èˆªèœå•å³å¯¹é½   | margin-left: auto | æŠŠæœ€åä¸€é“èœæ¨åˆ°é¤æ¡Œå³ä¾§ |

---

### âš ï¸ å¸¸è§è¸©å‘ç‚¹

1. **æ··æ·†ä¸»è½´æ–¹å‘**ï¼šflexå®¹å™¨çš„é»˜è®¤ä¸»è½´æ˜¯æ°´å¹³æ–¹å‘ï¼Œä½†`flex-direction: column`ä¼šè®©ä¸»è½´å˜å‚ç›´ï¼Œæ­¤æ—¶justify-contentæ§åˆ¶å‚ç›´æ’åˆ—ï¼Œalign-itemsæ§åˆ¶æ°´å¹³æ’åˆ—  
2. **å¤šè¡Œå¸ƒå±€å¤±æ•ˆ**ï¼šalign-itemsåªå¯¹å•è¡Œflexé¡¹ç›®ç”Ÿæ•ˆï¼Œå¤šè¡Œå¸ƒå±€éœ€è¦ç”¨align-content  
3. **å›¾ç‰‡å¯¹é½é™·é˜±**ï¼šç»™`<img>`è®¾ç½®text-alignæ— æ•ˆï¼Œéœ€æ”¹ç”¨flexå¸ƒå±€æˆ–`margin: 0 auto`

è¿™ä¸‰ä¸ªå±æ€§å°±åƒCSSå¸ƒå±€ä¸–ç•Œçš„XYZä¸‰è½´åæ ‡ç³»ï¼ŒæŒæ¡å®ƒä»¬çš„é…åˆä½¿ç”¨ï¼Œå°±èƒ½è®©å…ƒç´ åœ¨ä¸‰ç»´ç©ºé—´è·³å‡ºä¼˜é›…çš„æ’åˆ—ä¹‹èˆğŸ’ƒ

# axiosæ‹¦æˆªå™¨

## ä¸ªäººæ€»ç»“

### ä¸ªäººå†™çš„

æ‹¦æˆªå™¨æœ¬è´¨ä¸Šå°±æ˜¯ï¼Œä½ è‡ªå®šä¹‰ä¸€ä¸ªaxioså¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯axiosServiceï¼‰ï¼Œåœ¨æ¯æ¬¡å‘é€axiosè¯·æ±‚çš„æ—¶å€™å¯¹è¯·æ±‚è¿›è¡ŒåŠ å·¥ï¼Œä¸€èˆ¬æ˜¯åŠ ä¸Štokenï¼ŒåŒæ—¶å¯¹äºè¯·æ±‚çš„å“åº”çŠ¶æ€è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚è½¬åˆ°401çš„ä¸“é—¨é¡µé¢ä»€ä¹ˆçš„

```ts
import axios from "axios";
import host from "../config/hostname";

// åœ¨æ‹¦æˆªå™¨ä¸­ä½¿ç”¨æ—¶æ˜¾å¼ä¼ é€’
const hostname = host();


// åˆ›å»ºç‹¬ç«‹Axioså®ä¾‹[7,10](@ref)
const service = axios.create({
    baseURL: hostname, // å»ºè®®ä»ç¯å¢ƒå˜é‡è·å–[4](@ref)
    timeout: 15000,
});

// ==================== è¯·æ±‚æ‹¦æˆªå™¨ ====================
service.interceptors.request.use(
    config => {
        const url = config.url;
        if (sessionStorage.getItem("accessToken") && url?.indexOf("renewal") === -1) {
            try {
                const token = JSON.parse(sessionStorage.getItem("accessToken")!);
                config.headers["Authorization"] = `Bearer ${token}`; 
            } catch (e) {
                console.error("Tokenè§£æå¤±è´¥:", e);
                sessionStorage.removeItem("accessToken");
            }
        }
        return config;
    },
    error => Promise.reject(error)
);

// ==================== Tokenåˆ·æ–°æœºåˆ¶ ==================== 
const userIds = localStorage.getItem("userinfo")
async function getNewToken() {
    try {
        if (userIds) {
            const refreshToken = JSON.parse(sessionStorage.getItem("refreshToken")!);
            return await service.post("/auth/token/renewal",
                { id: JSON.parse(userIds) },
                {
                    headers: {
                        accessToken: refreshToken, // ä¿®æ­£headerå­—æ®µæ‹¼å†™
                        isRefresh: true
                    }
                }
            );
        }

    } catch (error) {
        console.error("åˆ·æ–°Tokenå¤±è´¥:", error);
        throw error;
    }
}

// ==================== å“åº”æ‹¦æˆªå™¨ ====================
service.interceptors.response.use(  
    async response => {
        
        if (response.status === 401 && !response.config.headers.isRefresh) {
            try {
                const res = await getNewToken();
                if (res && res.data && res.data.code === 200 && res.data.data && res.data.data.status) {
                    sessionStorage.setItem("accessToken", JSON.stringify(res.data.data.accessToken));

                    // Retry the original request
                    return service({
                        ...response.config,
                        headers: {
                            ...response.config.headers,
                            Authorization: `Bearer ${res.data.data.accessToken}`
                        }
                    });
                }

            } catch (error) {
                window.location.href = "/login";
                return Promise.reject(error);
            }
        }
        return response.data;
    },
    error => {
        if (error.response?.status === 404) {
            console.error("èµ„æºæœªæ‰¾åˆ°:", error.config.url);
            // router.push("/404");  // å»ºè®®ä½¿ç”¨vue-routerè·³è½¬[4](@ref)
        }
        return Promise.reject(error);
    }
);

export default service; // æ·»åŠ é»˜è®¤å¯¼å‡º[5,10](@ref)
```

ç„¶åå¦‚æœè¦ä½¿ç”¨ï¼Œå°±ç›´æ¥å¯¼å…¥å°±è¡Œï¼Œå°±ä¸è¦ç”¨axioså‘è¯·æ±‚äº†è€Œæ˜¯ç”¨ä½ è‡ªå®šä¹‰çš„axiosServiceå‘è¯·æ±‚

```ts
import axiosService from '../../utils/axios-test' // å¯¼å…¥é…ç½®å¥½çš„axioså®ä¾‹

const response = await axiosService.post(hostname + '/api/login', {  
          email: email,
          password: password,
        });
```

è¿˜æœ‰å°±æ˜¯=è¦æ³¨æ„çš„ç‚¹æ˜¯å¦‚æœä½ è‡ªå·±çš„è¯·æ±‚å°±å¸¦æœ‰è¯·æ±‚å¤´ï¼Œä¼šäº§ç”Ÿè¦†ç›–ï¼Œè®°å¾—å¸¦ä¸Štoken

åŒæ—¶è¦æ³¨æ„ï¼Œæ‹¦æˆªå™¨ä¸è¦å»æ‹¦æˆªrefreshTokençš„é‚£ä¸ªè¯·æ±‚ï¼Œå› ä¸ºé‚£æ—¶å€™çš„accessTokenå·²ç»è¿‡æœŸï¼Œä¸èƒ½å†å¸¦ç€å¥¹è¯·æ±‚äº†ï¼Œè¦å°†åŸæœ‰çš„accessTokenæ¢æˆrefreshTokenåœ¨è¯·æ±‚å¤´é‡Œé¢ã€‚

### AIåˆ†æ

å—¯ï¼Œç”¨æˆ·ç°åœ¨æƒ³è®©æˆ‘ç»“åˆä»–ä»¬æä¾›çš„TypeScriptä»£ç ï¼Œè®²è®²Axiosæ‹¦æˆªå™¨çš„ç”¨æ³•ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦å›é¡¾ä»–ä»¬ç»™å‡ºçš„ä»£ç ï¼Œè¿™æ˜¯è¯·æ±‚å’Œå“åº”æ‹¦æˆªå™¨çš„åŸºæœ¬ç»“æ„ã€‚ç„¶åï¼Œç»“åˆæœç´¢ç»“æœé‡Œçš„ä¿¡æ¯ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥è¡¥å……çš„ã€‚

æ ¹æ®æœç´¢ç»“æœï¼Œç½‘é¡µ1å’Œç½‘é¡µ3éƒ½æåˆ°äº†æ‹¦æˆªå™¨çš„åŸºæœ¬å†™æ³•ï¼Œç‰¹åˆ«æ˜¯è¯·æ±‚æ‹¦æˆªå™¨ä¸­æ·»åŠ tokenï¼Œå“åº”æ‹¦æˆªå™¨å¤„ç†é”™è¯¯çŠ¶æ€ç ã€‚ç”¨æˆ·æä¾›çš„ä»£ç é‡Œå·²ç»æœ‰è¿™äº›éƒ¨åˆ†ï¼Œä½†å¯èƒ½éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šã€‚ä¾‹å¦‚ï¼Œåœ¨è¯·æ±‚æ‹¦æˆªå™¨é‡Œï¼Œå¦‚ä½•ä¿®æ”¹configï¼Œæ¯”å¦‚æ·»åŠ headersçš„Authorizationå­—æ®µï¼Œè¿™åœ¨ç½‘é¡µ1çš„ä¾‹å­ä¸­ä¹Ÿæœ‰æåˆ°ã€‚

å¦å¤–ï¼Œç½‘é¡µ2å’Œç½‘é¡µ9æåˆ°ä½¿ç”¨TypeScriptè¿›è¡Œå°è£…ï¼Œéœ€è¦å¤„ç†ç±»å‹å®šä¹‰ã€‚ç”¨æˆ·çš„ä»£ç æ˜¯TypeScriptï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å¼ºè°ƒç±»å‹å®‰å…¨ï¼Œæ¯”å¦‚AxiosRequestConfigå’ŒAxiosResponseçš„ç±»å‹ä½¿ç”¨ã€‚ç½‘é¡µ2ä¸­çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å¼•å…¥è¿™äº›ç±»å‹ï¼Œå¹¶åº”ç”¨åˆ°æ‹¦æˆªå™¨ä¸­ï¼Œç¡®ä¿é…ç½®å’Œå“åº”çš„ç±»å‹æ­£ç¡®ã€‚

ç½‘é¡µ5å’Œç½‘é¡µ7è®¨è®ºäº†å¦‚ä½•å°è£…axioså®ä¾‹ï¼Œå¹¶æ·»åŠ æ‹¦æˆªå™¨ã€‚ç”¨æˆ·ä»£ç é‡Œä½¿ç”¨çš„æ˜¯å…¨å±€æ‹¦æˆªå™¨ï¼Œä½†å¯èƒ½å¯ä»¥å»ºè®®åˆ›å»ºå®ä¾‹ï¼Œä»¥ä¾¿æ›´å¥½çš„æ¨¡å—åŒ–ç®¡ç†ï¼Œå¦‚ç½‘é¡µ3ä¸­çš„ç¤ºä¾‹ï¼Œåˆ›å»ºserviceå®ä¾‹å¹¶æ·»åŠ æ‹¦æˆªå™¨ï¼Œè¿™æ ·å¯ä»¥é’ˆå¯¹ä¸åŒçš„APIç«¯ç‚¹é…ç½®ä¸åŒçš„æ‹¦æˆªé€»è¾‘ã€‚

å“åº”æ‹¦æˆªå™¨éƒ¨åˆ†ï¼Œç”¨æˆ·ä»£ç å¤„ç†äº†responseå’Œerrorï¼Œä½†å¯èƒ½éœ€è¦æ›´è¯¦ç»†çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œæ¯”å¦‚æ ¹æ®HTTPçŠ¶æ€ç è¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œå¦‚401è·³è½¬ç™»å½•ï¼Œ500æ˜¾ç¤ºæœåŠ¡å™¨é”™è¯¯ï¼Œè¿™åœ¨ç½‘é¡µ1ã€ç½‘é¡µ3å’Œç½‘é¡µ6ä¸­éƒ½æœ‰æåˆ°ã€‚ç‰¹åˆ«æ˜¯ç½‘é¡µ6ä¸­çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å¤„ç†ä¸åŒçŠ¶æ€ç ï¼Œå¹¶ç»™å‡ºç”¨æˆ·æç¤ºã€‚

è¿˜è¦æ³¨æ„æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºï¼Œå¦‚ç½‘é¡µ8æåˆ°çš„ï¼Œå¤šä¸ªè¯·æ±‚æ‹¦æˆªå™¨æŒ‰æ·»åŠ é¡ºåºåå‘æ‰§è¡Œï¼Œå“åº”æ‹¦æˆªå™¨æŒ‰æ·»åŠ é¡ºåºæ‰§è¡Œã€‚ç”¨æˆ·å¯èƒ½éœ€è¦äº†è§£è¿™ä¸€ç‚¹ï¼Œä»¥ä¾¿å®‰æ’æ‹¦æˆªå™¨çš„é€»è¾‘é¡ºåºï¼Œæ¯”å¦‚å…ˆæ·»åŠ çš„è¯·æ±‚æ‹¦æˆªå™¨åæ‰§è¡Œï¼Œè¿™åœ¨å¤„ç†headersæˆ–tokenæ—¶å¯èƒ½æœ‰å½±å“ã€‚

æ­¤å¤–ï¼ŒTypeScriptä¸­çš„ç±»å‹å¢å¼ºï¼Œå¦‚æ‰©å±•AxiosRequestConfigæ¥å£ï¼Œæ·»åŠ è‡ªå®šä¹‰é…ç½®é¡¹ï¼Œè¿™åœ¨ç½‘é¡µ2å’Œç½‘é¡µ7ä¸­æœ‰ç¤ºä¾‹ã€‚ç”¨æˆ·å¯èƒ½éœ€è¦åœ¨æ‹¦æˆªå™¨ä¸­ä½¿ç”¨è‡ªå®šä¹‰é…ç½®ï¼Œæ¯”å¦‚silenté€‰é¡¹æ¥ç¦æ­¢å…¨å±€loadingï¼Œè¿™éœ€è¦ç±»å‹å®šä¹‰çš„æ”¯æŒã€‚

æœ€åï¼Œé”™è¯¯å¤„ç†éƒ¨åˆ†ï¼Œç”¨æˆ·ä»£ç åœ¨å“åº”æ‹¦æˆªå™¨çš„erroréƒ¨åˆ†è¿”å›äº†Promise.rejectï¼Œç¡®ä¿é”™è¯¯èƒ½ç»§ç»­ä¼ é€’åˆ°è°ƒç”¨å¤„ï¼Œä»¥ä¾¿åœ¨å…·ä½“çš„è¯·æ±‚ä¸­å¤„ç†ï¼Œå¦‚ç½‘é¡µ5å’Œç½‘é¡µ7æåˆ°çš„ï¼Œç»Ÿä¸€å¤„ç†HTTPé”™è¯¯ï¼Œå¹¶åœ¨éœ€è¦æ—¶è·³è½¬ç™»å½•é¡µé¢ã€‚

ç»¼åˆè¿™äº›ç‚¹ï¼Œæˆ‘éœ€è¦åˆ†ç»“æ„è®²è§£ä»£ç ï¼Œå¼ºè°ƒTypeScriptçš„ç±»å‹å®‰å…¨ã€æ‹¦æˆªå™¨çš„åº”ç”¨åœºæ™¯ã€é”™è¯¯å¤„ç†ç­–ç•¥ã€å®ä¾‹åŒ–å°è£…ä»¥åŠæ‰§è¡Œé¡ºåºç­‰ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å…¨é¢ç†è§£å¹¶åº”ç”¨æ‹¦æˆªå™¨ã€‚




æ ¹æ®ä½ æä¾›çš„TypeScriptä»£ç å’Œæœç´¢ç»“æœä¸­çš„æœ€ä½³å®è·µï¼Œä»¥ä¸‹æ˜¯Axiosæ‹¦æˆªå™¨çš„æ ¸å¿ƒç”¨æ³•è§£æï¼ˆç»“åˆä¼ä¸šçº§é¡¹ç›®ç»éªŒï¼‰ï¼š

### ä¸€ã€æ‹¦æˆªå™¨æ¶æ„è§£æ

```typescript
// è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆæ‰€æœ‰axiosè¯·æ±‚ç”Ÿæ•ˆï¼‰
axios.interceptors.request.use(
  config => { // ç±»å‹æ¨æ–­ä¸ºAxiosRequestConfig
    // æ­¤å¤„å¯æ·»åŠ è®¤è¯ä»¤ç‰Œ
    config.headers.Authorization = `Bearer ${localStorage.getItem('token')}`; // 
    return config;
  },
  error => { // ç±»å‹ä¸ºAxiosError
    return Promise.reject(error); // å¿…é¡»æŠ›å‡ºé”™è¯¯
  }
)

// å“åº”æ‹¦æˆªå™¨ï¼ˆæ‰€æœ‰axioså“åº”ç”Ÿæ•ˆï¼‰
axios.interceptors.response.use(
  response => { // ç±»å‹ä¸ºAxiosResponse
    // æ•°æ®è„±å£³å¤„ç†ï¼ˆæ ¹æ®åç«¯æ•°æ®ç»“æ„è°ƒæ•´ï¼‰
    return response.data.payload; // 
  },
  error => {
    // ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆç½‘ç»œé”™è¯¯/ä¸šåŠ¡é”™è¯¯ï¼‰
    handleError(error.response?.status); // 
    return Promise.reject(error); 
  }
)
```

### äºŒã€TypeScriptå¼ºåŒ–å®è·µ

1. **ç±»å‹å¢å¼ºå£°æ˜**ï¼ˆå‚è€ƒç½‘é¡µ2/ç½‘é¡µ7ï¼‰ï¼š

```typescript
declare module 'axios' {
  interface AxiosRequestConfig {
    silent?: boolean;  // ç¦ç”¨å…¨å±€Loadingæç¤º
    retryCount?: number; // è‡ªåŠ¨é‡è¯•æ¬¡æ•°
  }
  
  interface AxiosResponse<T = any> {
    traceId: string; // é“¾è·¯è¿½è¸ªID
  }
}
```

2. **å¤šæ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº**ï¼ˆå‚è€ƒç½‘é¡µ8ï¼‰ï¼š

```typescript
// è¯·æ±‚æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåºï¼šåæ·»åŠ çš„å…ˆæ‰§è¡Œ
axios.interceptors.request.use(config => {
  console.log('æ‹¦æˆªå™¨2'); // æœ€åæ‰§è¡Œ
  return config;
});

axios.interceptors.request.use(config => {
  console.log('æ‹¦æˆªå™¨1'); // æœ€å…ˆæ‰§è¡Œ
  return config;
});

// å“åº”æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåºï¼šå…ˆæ·»åŠ çš„å…ˆæ‰§è¡Œ
axios.interceptors.response.use(res => {
  console.log('å“åº”1'); // å…ˆå¤„ç†
  return res;
});

axios.interceptors.response.use(res => {
  console.log('å“åº”2'); // åå¤„ç†
  return res;
});
```

### ä¸‰ã€ä¼ä¸šçº§åŠŸèƒ½æ‰©å±•

1. **è¯·æ±‚ç­¾å**ï¼ˆå‚è€ƒç½‘é¡µ7ï¼‰ï¼š

```typescript
config => {
  const timestamp = Date.now();
  config.headers['X-Sign'] = createSign({
    url: config.url,
    method: config.method,
    timestamp
  });
  return config;
}
```

2. **æ€§èƒ½ç›‘æ§**ï¼ˆå‚è€ƒç½‘é¡µ9ï¼‰ï¼š

```typescript
const startTime = Date.now();
return response => {
  const latency = Date.now() - startTime;
  trackPerformance({
    url: response.config.url,
    latency,
    status: response.status
  });
  return response;
}
```

3. **è‡ªåŠ¨é‡è¯•æœºåˆ¶**ï¼ˆå‚è€ƒç½‘é¡µ5ï¼‰ï¼š

```typescript
error => {
  const config = error.config;
  if(!config.retryCount) config.retryCount = 0;
  
  if(config.retryCount < 3 && error.code === 'ECONNABORTED') {
    config.retryCount++;
    return axios(config); // è‡ªåŠ¨é‡è¯•
  }
  return Promise.reject(error);
}
```

### å››ã€å¼€å‘æ³¨æ„äº‹é¡¹

1. **é…ç½®æ±¡æŸ“é—®é¢˜**  
   é¿å…ç›´æ¥ä¿®æ”¹åŸå§‹configå¯¹è±¡ï¼Œå»ºè®®ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼š

   ```typescript
   return { 
     ...config,
     headers: { ...config.headers, 'X-Trace': uuid() }
   }
   ```

2. **å¼‚æ­¥æ“ä½œå¤„ç†**  
   ä½¿ç”¨async/awaitå¤„ç†å¼‚æ­¥é€»è¾‘æ—¶éœ€ä¿æŒé“¾å¼è°ƒç”¨ï¼š

   ```typescript
   service.interceptors.request.use(async config => {
     const token = await refreshToken();
     config.headers.Authorization = token;
     return config;
   });
   ```

3. **ç±»å‹å®‰å…¨æ ¡éªŒ**  
   é€šè¿‡æ³›å‹å¼ºåŒ–å“åº”æ•°æ®ç±»å‹ï¼š

   ```typescript
   interface ApiResponse<T> {
     code: number;
     data: T;
     message: string;
   }
   
   axios.interceptors.response.use(
     (response: AxiosResponse<ApiResponse<any>>) => {
       if(response.data.code !== 200) throw new Error(response.data.message);
       return response.data.data;
     }
   )
   ```

å»ºè®®ç»“åˆVue3çš„Composition APIå°è£…æˆå¯å¤ç”¨çš„Hookï¼Œå¹¶é€šè¿‡å•å…ƒæµ‹è¯•éªŒè¯æ‹¦æˆªå™¨é€»è¾‘çš„å¥å£®æ€§ã€‚å…·ä½“é¡¹ç›®ç¤ºä¾‹å¯å‚è€ƒç½‘é¡µ7ä¸­Authç±»çš„å®ç°ï¼Œå®ç°Tokençš„è‡ªåŠ¨åŒ–ç®¡ç†ã€‚



## ä¸€ã€æ‹¦æˆªå™¨åŸºç¡€æ¶æ„

#### 1. å…¨å±€æ‹¦æˆªå™¨å†™æ³•

```javascript
// è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆæ‰€æœ‰axiosè¯·æ±‚ç”Ÿæ•ˆï¼‰
axios.interceptors.request.use(
  config => {
    // å‘é€è¯·æ±‚å‰çš„å¤„ç†é€»è¾‘
    return config // å¿…é¡»è¿”å›ä¿®æ”¹åçš„é…ç½®
  },
  error => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨ï¼ˆæ‰€æœ‰axioså“åº”ç”Ÿæ•ˆï¼‰
axios.interceptors.response.use(
  response => {
    // å¤„ç†å“åº”æ•°æ®ï¼ˆ2xxçŠ¶æ€ç ï¼‰
    return response 
  },
  error => {
    // å¤„ç†é”™è¯¯å“åº”ï¼ˆé2xxçŠ¶æ€ç ï¼‰
    return Promise.reject(error)
  }
)
```

> å¼•ç”¨ç¤ºä¾‹ï¼šç½‘é¡µ1ã€ç½‘é¡µ3ã€ç½‘é¡µ5å‡å±•ç¤ºäº†åŸºç¡€æ‹¦æˆªå™¨ç»“æ„

---

### äºŒã€ä¼ä¸šçº§å°è£…æ–¹æ¡ˆ

#### 1. åˆ›å»ºè‡ªå®šä¹‰å®ä¾‹ï¼ˆæ¨èï¼‰

```javascript
const service = axios.create({
  baseURL: 'http://api.example.com',
  timeout: 5000,
  headers: {'Content-Type': 'application/json'}
})
```

#### 2. å®ä¾‹ä¸“å±æ‹¦æˆªå™¨

```javascript
// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(config => {
  // æ·»åŠ è®¤è¯tokenï¼ˆå…¸å‹åœºæ™¯ï¼‰
  if (store.getters.token) {
    config.headers['X-Token'] = getToken() 
  }
  return config
})

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  response => {
    const res = response.data
    // ç»Ÿä¸€å¤„ç†ä¸šåŠ¡é”™è¯¯ç ï¼ˆå¦‚401è·³ç™»å½•ï¼‰
    if (res.code !== 200) {
      showErrorMessage(res.msg)
      return Promise.reject(new Error(res.msg))
    }
    return res.data // æ•°æ®è„±å£³
  },
  error => {
    // å¤„ç†HTTPçŠ¶æ€ç é”™è¯¯
    handleHttpError(error.response.status)
    return Promise.reject(error)
  }
)
```

> æœ€ä½³å®è·µå‚è€ƒï¼šç½‘é¡µ5çš„æƒé™éªŒè¯æ–¹æ¡ˆå’Œç½‘é¡µ3çš„å®ä¾‹å°è£…

---

### ä¸‰ã€å…­å¤§æ ¸å¿ƒåº”ç”¨åœºæ™¯

1. **è®¤è¯ä»¤ç‰Œæ³¨å…¥**  
   è‡ªåŠ¨æ·»åŠ JWTåˆ°è¯·æ±‚å¤´ï¼Œé¿å…æ‰‹åŠ¨ä¼ token

2. **è¯·æ±‚å‚æ•°é¢„å¤„ç†**  
   åºåˆ—åŒ–å‚æ•°ã€æ·»åŠ æ—¶é—´æˆ³ç­‰å…¬å…±å‚æ•°

3. **å…¨å±€LoadingçŠ¶æ€**  
   é€šè¿‡æ‹¦æˆªå™¨ç»Ÿä¸€ç®¡ç†è¯·æ±‚åŠ è½½æç¤º

4. **å“åº”æ•°æ®æ ¼å¼åŒ–**  
   æå–åµŒå¥—æ•°æ®ï¼ˆå¦‚`response.data.data -> data`ï¼‰

5. **é”™è¯¯ç»Ÿä¸€å¤„ç†**  
   æ ¹æ®çŠ¶æ€ç æ˜¾ç¤ºå¯¹åº”é”™è¯¯æç¤ºï¼ˆ401è·³ç™»å½•/500æ˜¾ç¤ºæœåŠ¡å¼‚å¸¸ï¼‰

6. **æ€§èƒ½ç›‘æ§**  
   è®°å½•è¯·æ±‚è€—æ—¶ï¼Œä¼˜åŒ–æ…¢æ¥å£

---

### å››ã€é«˜çº§ä½¿ç”¨æŠ€å·§

#### 1. æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº

```javascript
// æ·»åŠ é¡ºåºå†³å®šæ‰§è¡Œé¡ºåº
axios.interceptors.request.use(config => {
  console.log('ç¬¬ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨')
  return config
})

axios.interceptors.request.use(config => {
  console.log('ç¬¬äºŒä¸ªè¯·æ±‚æ‹¦æˆªå™¨') 
  return config
})
```

#### 2. åŠ¨æ€ç§»é™¤æ‹¦æˆªå™¨

```javascript
const myInterceptor = axios.interceptors.request.use(...)
axios.interceptors.request.eject(myInterceptor) // ç§»é™¤
```

> å‚è€ƒç½‘é¡µ3çš„æ‹¦æˆªå™¨ç®¡ç†æ–¹æ¡ˆ

#### 3. å¤šå®ä¾‹éš”ç¦»

```javascript
const api1 = axios.create({/* é…ç½®A */})
const api2 = axios.create({/* é…ç½®B */})

// å„å®ä¾‹ç‹¬ç«‹ç»´æŠ¤æ‹¦æˆªå™¨
api1.interceptors.request.use(...)
api2.interceptors.response.use(...) 
```

---

### äº”ã€å¼€å‘æ³¨æ„äº‹é¡¹

1. **é…ç½®å¿…é¡»è¿”å›**  
   è¯·æ±‚æ‹¦æˆªå™¨ä¸­å¿˜è®°`return config`ä¼šå¯¼è‡´è¯·æ±‚å¡æ­»

2. **é¿å…å¾ªç¯è°ƒç”¨**  
   åœ¨æ‹¦æˆªå™¨å†…è°ƒç”¨axioså¯èƒ½é€ æˆæ­»å¾ªç¯

3. **å¼‚æ­¥å¤„ç†**  
   éœ€è¦å¼‚æ­¥æ“ä½œæ—¶ä½¿ç”¨`async/await`ï¼š

   ```javascript
   service.interceptors.request.use(async config => {
     config.headers.token = await getTokenAsync()
     return config
   })
   ```

4. **é”™è¯¯ä¼ æ’­**  
   å“åº”æ‹¦æˆªå™¨ä¸­éœ€è¦å°†é”™è¯¯ç»§ç»­æŠ›å‡ºï¼Œå¦åˆ™`.catch`æ— æ³•æ•è·

---

### å…­ã€TypeScriptå¼ºåŒ–ï¼ˆè¿›é˜¶ï¼‰

```typescript
declare module 'axios' {
  interface AxiosRequestConfig {
    silent?: boolean // è‡ªå®šä¹‰é…ç½®é¡¹
  }
}

// ä½¿ç”¨å¢å¼ºç±»å‹
service.interceptors.request.use(config => {
  if (!config.silent) {
    showLoading()
  }
  return config
})
```

é€šè¿‡åˆç†ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå¯å‡å°‘30%ä»¥ä¸Šçš„é‡å¤ä»£ç é‡ã€‚å»ºè®®ç»“åˆVuex/Piniaè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œå®ç°æ›´ä¼˜é›…çš„å…¨å±€è¯·æ±‚æ§åˆ¶ã€‚å…·ä½“é¡¹ç›®ç¤ºä¾‹å¯å‚è€ƒç½‘é¡µ5çš„æƒé™ç®¡ç†æ–¹æ¡ˆã€‚

# åŒTokenéªŒè¯æŠ€æœ¯

### ä¸€ã€åŒTokençš„è¯ç”Ÿï¼šä¸´æ—¶å·¥ç‰Œä¸é•¿æœŸç­¾è¯

**[åœºæ™¯]**  
æƒ³è±¡ä½ è¿›å…¥ä¸€å®¶é«˜ç§‘æŠ€å›­åŒºï¼š  
â€¢ **Access Token** æ˜¯ **ä¸´æ—¶å·¥ç‰Œ**ï¼ˆæœ‰æ•ˆæœŸ2å°æ—¶ï¼‰ï¼Œæ¯æ¬¡è¿›å‡ºé—¸æœºéƒ½è¦åˆ·å¡éªŒè¯  
â€¢ **Refresh Token** æ˜¯ **é•¿æœŸç­¾è¯**ï¼ˆæœ‰æ•ˆæœŸ7å¤©ï¼‰ï¼Œç”¨äºåœ¨å·¥ç‰Œè¿‡æœŸæ—¶å¿«é€Ÿè¡¥åŠæ–°å·¥ç‰Œ

**[å®ç°æ­¥éª¤]**  

```typescript
// ç™»å½•æ¥å£è¿”å›ç¤ºä¾‹
interface TokenPair {
  accessToken: string     // é—¨ç¦å¡ï¼ˆæ˜“ç¢å“ï¼‰
  refreshToken: string    // å›­åŒºé€šè¡Œè¯ï¼ˆä¿é™©æŸœå­˜æ”¾ï¼‰
  expiresIn: number       // 2å°æ—¶åéœ€æ›´æ–°
}
```

---

### äºŒã€ä»¤ç‰Œå­˜å‚¨ï¼šä¿é™©æŸœä¸éšèº«åŒ…

**[å®‰å…¨ç­–ç•¥]**  
â€¢ **Access Token** å­˜å†…å­˜æˆ–`sessionStorage`ï¼ˆç±»ä¼¼éšèº«åŒ…ï¼Œæ–¹ä¾¿å–ç”¨ä½†æ˜“ä¸¢å¤±ï¼‰  
â€¢ **Refresh Token** å­˜`HttpOnly Cookie`ï¼ˆç±»ä¼¼ä¿é™©æŸœï¼Œé˜²XSSç›—çªƒï¼‰

**[ä»£ç ç¤ºä¾‹]**  

```typescript
// å®‰å…¨å­˜å‚¨å·¥å…·ç±»
const storeTokens = (tokens: TokenPair) => {
  sessionStorage.setItem('accessToken', tokens.accessToken) // éšèº«æºå¸¦
  document.cookie = `refreshToken=${tokens.refreshToken}; Path=/; Secure` // ä¿é™©æŸœ
}
```

---

### ä¸‰ã€è¯·æ±‚æ‹¦æˆªï¼šæ™ºèƒ½é—¸æœºç³»ç»Ÿ

**[å·¥ä½œæµç¨‹]**  

1. **æ­£å¸¸é€šè¡Œ**ï¼šæ¯æ¬¡è¯·æ±‚è‡ªåŠ¨æºå¸¦Access Token  
2. **è¿‡æœŸæ£€æµ‹**ï¼šå½“é—¸æœºæç¤º"å·¥ç‰Œå¤±æ•ˆ"ï¼ˆ401é”™è¯¯ï¼‰  
3. **è‡ªåŠ¨ç»­æœŸ**ï¼šç”¨Refresh Tokenå‘¼å«å›­åŒºæœåŠ¡ä¸­å¿ƒæ¢æ–°å·¥ç‰Œ

**[axiosæ‹¦æˆªå™¨å®ç°]**  

```typescript
// è¯·æ±‚æ‹¦æˆªå™¨ - è‡ªåŠ¨ä½©æˆ´å·¥ç‰Œ
service.interceptors.request.use(config => {
  if (!isRefreshRequest(config.url)) { // æ’é™¤åˆ·æ–°Tokençš„è¯·æ±‚
    config.headers.Authorization = `Bearer ${getAccessToken()}` 
  }
  return config
})

// å“åº”æ‹¦æˆªå™¨ - æ™ºèƒ½ç»­æœŸ
service.interceptors.response.use(null, async error => {
  if (error.response?.status === 401 && !error.config._retry) {
    error.config._retry = true
    const newTokens = await refreshToken() // è°ƒç”¨åˆ·æ–°æ¥å£
    resetAuthHeader(newTokens.accessToken) // æ›´æ–°è¯·æ±‚å¤´
    return service(error.config) // é‡æ–°å‘é€åŸè¯·æ±‚
  }
  return Promise.reject(error)
})
```

---

### å››ã€æ— æ„Ÿåˆ·æ–°ï¼šéšå½¢ç»´ä¿®å·¥

**[å¹•åæœºåˆ¶]**  
â€¢ **è¯·æ±‚é˜Ÿåˆ—**ï¼šå½“å¤šä¸ªè¯·æ±‚åŒæ—¶å‘ç°Tokenè¿‡æœŸï¼Œé¦–ä¸ªè¯·æ±‚è§¦å‘åˆ·æ–°ï¼Œå…¶ä»–è¯·æ±‚æ’é˜Ÿç­‰å€™æ–°Token  
â€¢ **é™é»˜åˆ·æ–°**ï¼šåœ¨ç”¨æˆ·æ— æ„ŸçŸ¥æ—¶å®Œæˆç»­æœŸï¼Œé¿å…æ“ä½œä¸­æ–­ï¼ˆå¦‚åŒç”µæ¢¯ç»´ä¿®ä¸å½±å“ä½¿ç”¨ï¼‰

**[ä»£ç é€»è¾‘]**  

```typescript
let isRefreshing = false // åˆ·æ–°çŠ¶æ€é”
const queue: ((token: string) => void)[] = [] // ç­‰å¾…é˜Ÿåˆ—

const addToQueue = (resolve: (value: unknown) => void) => {
  queue.push((newToken: string) => {
    resolve(service.request({ ...originalConfig, headers: { Authorization: `Bearer ${newToken}` } }))
  })
}
```

---

### äº”ã€å®‰å…¨é˜²çº¿ï¼šå¤šå±‚å®‰ä¿ç³»ç»Ÿ

1. **åŠ å¯†å­˜å‚¨**ï¼šç”¨AESåŠ å¯†Tokenï¼Œå¦‚åŒç»™ä¿é™©ç®±ä¸Šå¯†ç é”  
2. **è®¾å¤‡æŒ‡çº¹**ï¼šç»‘å®šè®¾å¤‡ç‰¹å¾ï¼Œé˜²æ­¢ä»¤ç‰Œå¼‚åœ°ä½¿ç”¨  
3. **é»‘åå•æœºåˆ¶**ï¼šæœåŠ¡ç«¯è®°å½•å·²æ³¨é”€çš„Refresh Tokenï¼Œå¦‚åŒæŒ‚å¤±çš„æŠ¤ç…§

**[å®‰å…¨å¢å¼ºç¤ºä¾‹]**  

```typescript
// ç”Ÿæˆè®¾å¤‡æŒ‡çº¹
const generateFingerprint = () => {
  return navigator.userAgent + screen.width + screen.colorDepth // ç»„åˆè®¾å¤‡ç‰¹å¾
}

// è¯·æ±‚æºå¸¦æŒ‡çº¹
service.interceptors.request.use(config => {
  config.headers['X-DeviceID'] = deviceFingerprint
  return config
})
```

---

### å…­ã€å¼‚å¸¸å¤„ç†ï¼šåº”æ€¥é¢„æ¡ˆæ‰‹å†Œ

1. **åŒTokenåŒæ—¶è¿‡æœŸ**ï¼šè·³è½¬ç™»å½•é¡µï¼Œå¦‚åŒå›­åŒºå…¨é¢å®‰æ£€  
2. **åˆ·æ–°å¤±è´¥**ï¼šæ¸…é™¤æœ¬åœ°å­˜å‚¨ï¼Œæç¤ºé‡æ–°ç™»å½•  
3. **é«˜é¢‘åˆ·æ–°æŠ¥è­¦**ï¼šç›‘æ§å¼‚å¸¸è¯·æ±‚ï¼Œé˜²å¾¡æ¶æ„æ”»å‡»

**[è·¯ç”±å®ˆå«ç¤ºä¾‹]**  

```typescript
// é¡µé¢è®¿é—®æ‹¦æˆª
router.beforeEach(async (to) => {
  if (to.meta.requiresAuth) {
    try {
      await silentRefresh() // å°è¯•é™é»˜åˆ·æ–°
      return true
    } catch {
      return { path: '/login', query: { redirect: to.path } }
    }
  }
})
```

---

**æŠ€æœ¯é€‰å‹å»ºè®®**ï¼š  
â€¢ æœ‰æ•ˆæœŸè®¾ç½®ï¼šAccess Tokenï¼ˆ15-30åˆ†é’Ÿï¼‰ï¼ŒRefresh Tokenï¼ˆ7-30å¤©ï¼‰  
â€¢ åŠ å¯†åº“æ¨èï¼š`crypto-js`ç”¨äºå‰ç«¯åŠ å¯†ï¼Œ`jsonwebtoken`ç”¨äºæœåŠ¡ç«¯ç­¾å‘  
â€¢ ç›‘æ§æŒ‡æ ‡ï¼šè®°å½•Tokenåˆ·æ–°é¢‘ç‡ã€å¼‚å¸¸è®¾å¤‡è¯·æ±‚ç­‰å®‰å…¨æ—¥å¿—

é€šè¿‡è¿™å¥—æœºåˆ¶ï¼Œç”¨æˆ·å°±åƒåœ¨æ‹¥æœ‰éšå½¢å®‰ä¿çš„æ™ºèƒ½å›­åŒºä¸­ç•…è¡Œæ— é˜»â€”â€”æ—¢äº«å—æ— ç¼ä½“éªŒï¼Œåˆè·å¾—é“¶è¡Œçº§å®‰å…¨é˜²æŠ¤ã€‚
